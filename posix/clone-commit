#!/bin/sh

FLAGS=""
if [[ ! -z "${PLUGIN_DEPTH}" ]]; then
	FLAGS="--depth=${PLUGIN_DEPTH}"
fi

if [[ ! -z "${PLUGIN_TAGS}" ]]; then
	FLAGS="$FLAGS -t"
fi

if [[ ! -z "${PLUGIN_QUIET}" ]]; then
	FLAGS="$FLAGS --quiet"
fi

if [ ! -d .git ]; then
	git init
	git remote add origin ${DRONE_REMOTE_URL}
fi

set -e
set -x

git fetch ${FLAGS} origin +refs/heads/${DRONE_BRANCH}:
git checkout ${DRONE_COMMIT} -b ${DRONE_BRANCH}
